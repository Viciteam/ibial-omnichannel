

stages:
    - build
    - test
    - deploy

image: alpine

build:
    stage: build
    script:
        - echo " Build a"

test:
    stage: test
    script:
        - echo " test a"

deploy:
    stage: deploy

    before_script:
#    - 'command -v ssh-agent >/dev/null || (apk --update add openssh-client)'
#    - mkdir -p ~/.ssh
#    - echo -e $SSH_PRIVATE_KEY > ~/.ssh/id_rsa
#    - chmod 400 ~/.ssh/id_rsa

      # Setup SSH deploy keys
    - 'which ssh-agent || ( apk --update add openssh-client )'
    - eval $(ssh-agent -s)
    - ssh-add <(echo "$SSH_PRIVATE_KEY")
    - mkdir -p ~/.ssh
    - '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'

    script:
        - echo "Deploying now..."
        - cat ~/.ssh/id_rsa
        - cat /root/.ssh/id_rsa
        #- ssh ubuntu@ec2-34-220-156-84.us-west-2.compute.amazonaws.com  "sudo bash /var/www/html/test.sh"
